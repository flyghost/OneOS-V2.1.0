from build_tools import *
Import('OS_ROOT')
Import('BEKEN_CFG')

cwd  = PresentDir()
list = os.listdir(cwd)

#BEKEN_CFG=OS_ROOT/projects/bk7231N/board
#sys_config = os.path.join(cwd, '..', 'config', 'sys_config.h')
sys_config = BEKEN_CFG
options = LocalOptions(sys_config)

src = []
src += ["driver/audio/ring_buffer_dma_write.c"]
#src += ["driver/codec/driver_codec_es8374.c"]
src += ["driver/common/dd.c"]
src += ["driver/common/drv_model.c"]
src += ["driver/dma/dma.c"]
src += ["driver/entry/arch_main.c"]
src += ["driver/fft/fft.c"]
src += ["driver/flash/flash.c"]
src += ["driver/general_dma/general_dma.c"]
src += ["driver/gpio/gpio.c"]
src += ["driver/i2s/i2s.c"]
src += ["driver/icu/icu.c"]
src += ["driver/intc/intc.c"]
src += ["driver/irda/irda.c"]
src += ["driver/macphy_bypass/mac_phy_bypass.c"]
src += ["driver/phy/phy_trident.c"]
src += ["driver/pwm/pwm.c"]
src += ["driver/pwm/pwm_new.c"]
src += ["driver/pwm/mcu_ps_timer.c"]
src += ["driver/pwm/bk_timer.c"]
src += ["driver/saradc/saradc.c"]
src += ["driver/sdcard/sdcard.c"]
src += ["driver/sdcard/sdio_driver.c"]


src += ["driver/spi/spi.c"]
src += ["driver/spidma/spidma.c"]
src += ["driver/spi/spi_master.c"]
src += ["driver/spi/spi_psram.c"]
src += ["driver/spi/spi_flash.c"]
src += ["driver/spi/spi_slave.c"]
src += ["driver/jpeg/jpeg_encoder.c"]
src += ["driver/i2c/i2c1.c"]
src += ["driver/i2c/i2c2.c"]
src += ["driver/sys_ctrl/sys_ctrl.c"]
src += ["driver/uart/Retarget.c"]
src += ["driver/uart/uart.c"]
src += ["driver/wdt/wdt.c"]
#oneos to do
"""
src += ["driver/usb/usb.c"]
"""
src += ["driver/rw_pub/rw_platf_pub.c"]
src += ["driver/driver.c"]
src += ["driver/qspi/qspi.c"]

# Replace by oneos
"""
src += ["rttos/source/rtos_pub.c"]
src += ["rttos/source/port.c"]
src += ["rttos/source/port_asm.S"]
src += ["rttos/source/rtos_task.c"]
src += ["rttos/mem_arch.c"]
src += ["rttos/os_clock.c"]
src += ["rttos/str_arch.c"]
src += ["rttos/target_util.c"]
src += ["rttos/ate/rtt_ate_app.c"]  
"""

src += ["oneos/source/rtos_pub.c"]
src += ["oneos/source/port.c"]
src += ["oneos/source/port_asm.S"]
src += ["oneos/source/rtos_task.c"]
src += ["oneos/mem_arch.c"]
src += ["oneos/bk_oneos_clock.c"]
src += ["oneos/str_arch.c"]
src += ["oneos/target_util.c"]
src += ["oneos/ate/rtt_ate_app.c"]  

  
src += ["func/saradc_intf/saradc_intf.c"]
src += ["app/config/param_config.c"]
src += ["app/app.c"]
src += ["app/standalone-ap/sa_ap.c"]
src += ["app/standalone-station/sa_station.c"]
src += ["demo/ieee802_11_demo.c"]
src += ["func/func.c"]
src += ["func/audio/audio_intf.c"]

src += ["func/power_save/power_save.c"]
src += ["func/power_save/mcu_ps.c"]
src += ["func/power_save/manual_ps.c"]
src += ["func/power_save/ap_idle.c"]

src += ["func/rwnx_intf/rw_msg_rx.c"]
src += ["func/net_param_intf/net_param.c"]
src += ["func/misc/pseudo_random.c"]
src += ["func/misc/start_type.c"]
src += ["func/joint_up/role_launch.c"]
src += ["func/bk7011_cal/bk7231_cal.c"]
src += ["func/bk7011_cal/bk7231U_cal.c"]
src += ["func/bk7011_cal/bk7231N_cal.c"]
src += ["func/bk7011_cal/bk7221U_cal.c"]
src += ["func/bk7011_cal/manual_cal_bk7231.c"]
src += ["func/bk7011_cal/manual_cal_bk7231U.c"]
src += ["func/ble_wifi_exchange/ble_wifi_port.c"]
src += ["func/temp_detect/temp_detect.c"]
src += ["func/rwnx_intf/rw_ieee80211.c"]
src += ["func/rwnx_intf/rw_msdu.c"]
src += ["func/rwnx_intf/rw_msg_tx.c"]
src += ["func/rf_test/tx_evm.c"]
src += ["func/rf_test/rx_sensitivity.c"]
#src += ["func/sdio_intf/sdio_intf.c"]
#src += ["func/sdio_trans/sdio_trans.c"]
src += ["func/uart_debug/cmd_rx_sensitivity.c"]
src += ["func/uart_debug/cmd_evm.c"]
src += ["func/uart_debug/command_line.c"]         
src += ["func/user_driver/BkDriverFlash.c"]
src += ["func/wlan_ui/wlan_ui.c"]
src += ["func/hostapd_intf/hostapd_intf.c"]

src += ["func/user_driver/BkDriverPwm.c"]
src += ["func/user_driver/BkDriverQspi.c"]
#oneos to do
"""
src += ["func/usb/fusb.c"]
src += ["func/usb_plug/usb_plug.c"]
"""

if 1 or (IsLocalDefined(options, 'CFG_USE_WPA_29') == 1):
    hostapd_path = "func/wpa_supplicant-2.9/"
    src += [hostapd_path + "wpa_supplicant/op_classes.c"]
else:
    hostapd_path = "func/hostapd-2.5/"

if (IsLocalDefined(options, 'CFG_WPA3') == 1):
    src += [hostapd_path + "src/common/sae.c"]
    src += [hostapd_path + "src/crypto/aes-ctr.c"]
    src += [hostapd_path + "src/crypto/aes-omac1.c"]
    src += [hostapd_path + "src/crypto/aes-siv.c"]
    src += [hostapd_path + "src/crypto/crypto_wolfssl.c"]
    src += [hostapd_path + "src/crypto/dh_group5.c"]
    src += [hostapd_path + "src/crypto/dh_groups.c"]
    src += [hostapd_path + "src/crypto/sha256.c"]
    src += [hostapd_path + "src/crypto/sha256-internal.c"]
    src += [hostapd_path + "src/crypto/sha256-prf.c"]
    src += ["func/wolfssl/wolfcrypt/src/wolfmath.c"]
    src += ["func/wolfssl/wolfcrypt/src/memory.c"]
    src += ["func/wolfssl/wolfcrypt/src/tfm.c"]
    src += ["func/wolfssl/wolfcrypt/src/ecc.c"]
    src += ["func/wolfssl/wolfcrypt/src/random.c"]
    src += ["func/wolfssl/wolfcrypt/src/sha256.c"]

src += [hostapd_path + "bk_patch/ddrv.c"]
src += [hostapd_path + "bk_patch/signal.c"]
src += [hostapd_path + "bk_patch/sk_intf.c"]
src += [hostapd_path + "bk_patch/fake_socket.c"]
src += [hostapd_path + "hostapd/main_none.c"]
src += [hostapd_path + "src/ap/ap_config.c"]
src += [hostapd_path + "src/ap/ap_drv_ops.c"]
src += [hostapd_path + "src/ap/ap_list.c"]
src += [hostapd_path + "src/ap/ap_mlme.c"]
#src += [hostapd_path + "src/ap/authsrv.c"]
src += [hostapd_path + "src/ap/beacon.c"]
#src += [hostapd_path + "src/ap/bss_load.c"]
#src += [hostapd_path + "src/ap/dfs.c"]
src += [hostapd_path + "src/ap/drv_callbacks.c"]
#src += [hostapd_path + "src/ap/eap_user_db.c"]
src += [hostapd_path + "src/ap/hostapd.c"]
src += [hostapd_path + "src/ap/hw_features.c"]
src += [hostapd_path + "src/ap/ieee802_11_auth.c"]
src += [hostapd_path + "src/ap/ieee802_11.c"]
src += [hostapd_path + "src/ap/ieee802_11_ht.c"]
src += [hostapd_path + "src/ap/ieee802_11_shared.c"]
src += [hostapd_path + "src/ap/ieee802_1x.c"]
src += [hostapd_path + "src/ap/pmksa_cache_auth.c"]
src += [hostapd_path + "src/ap/sta_info.c"]
src += [hostapd_path + "src/ap/tkip_countermeasures.c"]
src += [hostapd_path + "src/ap/utils.c"]
src += [hostapd_path + "src/ap/wmm.c"]
src += [hostapd_path + "src/ap/wpa_auth.c"]
src += [hostapd_path + "src/ap/wpa_auth_glue.c"]
src += [hostapd_path + "src/ap/wpa_auth_ie.c"]
src += [hostapd_path + "src/common/hw_features_common.c"]
src += [hostapd_path + "src/common/ieee802_11_common.c"]
src += [hostapd_path + "src/common/wpa_common.c"]
src += [hostapd_path + "src/crypto/aes-internal.c"]
src += [hostapd_path + "src/crypto/aes-internal-dec.c"]
src += [hostapd_path + "src/crypto/aes-internal-enc.c"]
src += [hostapd_path + "src/crypto/aes-unwrap.c"]
src += [hostapd_path + "src/crypto/aes-wrap.c"]
src += [hostapd_path + "src/crypto/md5.c"]
src += [hostapd_path + "src/crypto/md5-internal.c"]
src += [hostapd_path + "src/crypto/rc4.c"]
src += [hostapd_path + "src/crypto/sha1.c"]
src += [hostapd_path + "src/crypto/sha1-internal.c"]
src += [hostapd_path + "src/crypto/sha1-pbkdf2.c"]
src += [hostapd_path + "src/crypto/sha1-prf.c"]
src += [hostapd_path + "src/crypto/tls_none.c"]
src += [hostapd_path + "src/drivers/driver_beken.c"]
src += [hostapd_path + "src/drivers/driver_common.c"]
src += [hostapd_path + "src/drivers/drivers.c"]
#src += [hostapd_path + "src/eap_common/eap_common.c"]
#src += [hostapd_path + "src/eapol_auth/eapol_auth_sm.c"]
#src += [hostapd_path + "src/eap_server/eap_server.c"]
#src += [hostapd_path + "src/eap_server/eap_server_methods.c"]
src += [hostapd_path + "src/l2_packet/l2_packet_none.c"]
#src += [hostapd_path + "src/rsn_supp/preauth.c"]
src += [hostapd_path + "src/rsn_supp/wpa.c"]
src += [hostapd_path + "src/rsn_supp/wpa_ie.c"]
src += [hostapd_path + "src/utils/common.c"]
src += [hostapd_path + "src/utils/eloop.c"]
src += [hostapd_path + "src/utils/os_none.c"]
src += [hostapd_path + "src/utils/wpabuf.c"]
src += [hostapd_path + "src/utils/wpa_debug.c"]
src += [hostapd_path + "wpa_supplicant/blacklist.c"]
src += [hostapd_path + "wpa_supplicant/bss.c"]
src += [hostapd_path + "wpa_supplicant/config.c"]
src += [hostapd_path + "wpa_supplicant/config_none.c"]
src += [hostapd_path + "wpa_supplicant/events.c"]
src += [hostapd_path + "wpa_supplicant/main_supplicant.c"]
src += [hostapd_path + "wpa_supplicant/notify.c"]
src += [hostapd_path + "wpa_supplicant/wmm_ac.c"]
src += [hostapd_path + "wpa_supplicant/wpa_scan.c"]
src += [hostapd_path + "wpa_supplicant/wpas_glue.c"]
src += [hostapd_path + "wpa_supplicant/wpa_supplicant.c"]
src += ["func/spidma_intf/spidma_intf.c"]
src += ["func/camera_intf/camera_intf.c"]
src += ["func/video_transfer/video_transfer.c"]
src += ["func/video_transfer/video_buffer.c"]
#src += ["func/voice_transfer/voice_transfer.c"]
src += ["func/lwip_intf/dhcpd/dhcp-server.c"]
src += ["func/lwip_intf/dhcpd/dhcp-server-main.c"]
#src += ["func/vad/vad.c"]
#src += ["func/vad/vad_core.c"]
#src += ["func/vad/wb_vad.c"]
src += ["func/rf_use/arbitrate.c"]
src += ["func/wpa_supplicant-2.9/src/common/wpa_psk_cache.c"]

path = []
path += [cwd + '/../drivers/wlan/']
path += [cwd + '/app']
path += [cwd + '/app/config']
path += [cwd + '/app/standalone-ap']
path += [cwd + '/app/standalone-station']
path += [cwd + '/app/led']
path += [cwd + '/app/app_demo']
path += [cwd + '/common']
path += [cwd + '/release']
path += [cwd + '/demo']
path += [cwd + '/driver/audio']
path += [cwd + '/driver/codec']
path += [cwd + '/driver/common']
path += [cwd + '/driver/common/reg']
path += [cwd + '/driver/dma']
path += [cwd + '/driver/entry'] 
path += [cwd + '/driver/fft']
path += [cwd + '/driver/flash']
path += [cwd + '/driver/general_dma']
path += [cwd + '/driver/gpio']
path += [cwd + '/driver/i2s']
path += [cwd + '/driver/icu']
path += [cwd + '/driver/include']
path += [cwd + '/driver/intc']
path += [cwd + '/driver/irda']
path += [cwd + '/driver/macphy_bypass']
path += [cwd + '/driver/phy']
path += [cwd + '/driver/pwm']

path += [cwd + '/driver/rc_beken']
path += [cwd + '/driver/saradc']
path += [cwd + '/driver/sdcard']
path += [cwd + '/driver/sdio']
path += [cwd + '/driver/spi']
path += [cwd + '/driver/spidma']
path += [cwd + '/driver/sys_ctrl']
path += [cwd + '/driver/uart']
path += [cwd + '/driver/wdt']
path += [cwd + '/driver/rw_pub']
path += [cwd + '/driver/jpeg']
path += [cwd + '/driver/i2c']
path += [cwd + '/driver/security']
path += [cwd + '/func/sdio_intf']

#oneos to do
"""
path += [cwd + '/driver/usb']
path += [cwd + '/driver/usb/include']
path += [cwd + '/driver/usb/include/class']
path += [cwd + '/driver/usb/src/cd']
path += [cwd + '/driver/usb/src/drivers/comm']
path += [cwd + '/driver/usb/src/drivers/compl']
path += [cwd + '/driver/usb/src/drivers/hid']
path += [cwd + '/driver/usb/src/drivers/hub']
path += [cwd + '/driver/usb/src/drivers/msd']
path += [cwd + '/driver/usb/src/drivers/trans']
path += [cwd + '/driver/usb/src/examples']
path += [cwd + '/driver/usb/src/hid']
path += [cwd + '/driver/usb/src/msc']
path += [cwd + '/driver/usb/src/systems/none']
path += [cwd + '/driver/usb/src/systems/none/afs']
path += [cwd + '/driver/usb/src/test']
path += [cwd + '/driver/usb/src/test/cbs']
path += [cwd + '/driver/usb/src/test/compl']
path += [cwd + '/driver/usb/src/test/hub']
path += [cwd + '/driver/usb/src/uvc']
"""


# Replace by oneos
"""
path += [cwd + '/rttos/include']
path += [cwd + '/rttos/source']
path += [cwd + '/rttos/ate']
"""
path += [cwd + '/oneos/include']
path += [cwd + '/oneos/source']
path += [cwd + '/oneos/ate']

path += [cwd + '/ip/common']
path += [cwd + '/ip/ke']
path += [cwd + '/ip/mac']
path += [cwd + '/ip/lmac/src/hal']
path += [cwd + '/ip/lmac/src/mm']
path += [cwd + '/ip/lmac/src/ps']
path += [cwd + '/ip/lmac/src/rd']
path += [cwd + '/ip/lmac/src/rx']
path += [cwd + '/ip/lmac/src/scan']
path += [cwd + '/ip/lmac/src/sta']
path += [cwd + '/ip/lmac/src/tx']
path += [cwd + '/ip/lmac/src/vif']
path += [cwd + '/ip/lmac/src/rx/rxl']
path += [cwd + '/ip/lmac/src/tx/txl']
path += [cwd + '/ip/lmac/src/rwnx']
path += [cwd + '/ip/lmac/src/p2p']
path += [cwd + '/ip/lmac/src/chan']
path += [cwd + '/ip/lmac/src/td']
path += [cwd + '/ip/lmac/src/tpc']
path += [cwd + '/ip/lmac/src/tdls']
path += [cwd + '/ip/umac/src/bam']
path += [cwd + '/ip/umac/src/llc']
path += [cwd + '/ip/umac/src/me']
path += [cwd + '/ip/umac/src/rxu']
path += [cwd + '/ip/umac/src/scanu']
path += [cwd + '/ip/umac/src/sm']
path += [cwd + '/ip/umac/src/txu']
path += [cwd + '/ip/umac/src/apm']
path += [cwd + '/ip/umac/src/rc']
path += [cwd + '/ip/umac/src/mesh']
path += [cwd + '/func']
path += [cwd + '/func/include']
path += [cwd + '/func/rf_test']
path += [cwd + '/func/joint_up']
path += [cwd + '/func/temp_detect']
path += [cwd + '/func/user_driver']
path += [cwd + '/func/power_save']
path += [cwd + '/func/ethernet_intf']
path += [cwd + '/func/uart_debug']
path += [cwd + '/func/ip/umac/src/apm']
path += [cwd + '/func/rwnx_intf']
if 1 or (IsLocalDefined(options, 'CFG_USE_WPA_29') == 1):
    path += [cwd + '/func/wpa_supplicant-2.9/src']
    path += [cwd + '/func/wpa_supplicant-2.9/bk_patch']
    path += [cwd + '/func/wpa_supplicant-2.9/hostapd']
    path += [cwd + '/func/wpa_supplicant-2.9/src/utils']
    path += [cwd + '/func/wpa_supplicant-2.9/src/drivers']
    path += [cwd + '/func/wpa_supplicant-2.9/src/common']
else:
    path += [cwd + '/func/hostapd-2.5/src']
    path += [cwd + '/func/hostapd-2.5/bk_patch']
    path += [cwd + '/func/hostapd-2.5/hostapd']
    path += [cwd + '/func/hostapd-2.5/src/utils']
    path += [cwd + '/func/hostapd-2.5/src/drivers']
    path += [cwd + '/func/hostapd-2.5/src/common']
path += [cwd + '/func/wpa_supplicant-2.9/src/common/']
path += [cwd + '/func/vad']
path += [cwd + '/func/spidma_intf']
path += [cwd + '/func/camera_intf']
path += [cwd + '/func/video_transfer']
path += [cwd + '/func/voice_transfer']
path += [cwd + '/func/lwip_intf/dhcpd']
path += [cwd + '/func/rf_use']
path += [cwd + '/func/ble_wifi_exchange']
path += [cwd + '/func/saradc_intf']
path += [cwd + '/func/sensor']
if (IsLocalDefined(options, 'CFG_WPA3') == 1):
    path += [cwd + '/func/wolfssl']

#if (0 == string.find(IsLocalDefined(options, 'CFG_SOC_NAME'), 'SOC_BK7231N')):
if (IsLocalDefined(options, 'CFG_SOC_NAME') == 'SOC_BK7231N'):
    src += ["driver/calendar/calendar.c"]
    path += [cwd + '/driver/calendar']

libs = []

libpath = []

objs = []

# Compile only by SOC_FAMILY_BK72XX family Socs 
if (IsDefined('SOC_FAMILY_BK72XX') == False):
    #print ('IsDefined SOC_FAMILY_BK72XX')
    Return('objs') 

cppdefines  = ['CFG_SUPPORT_RTT=1']
cppdefines += ['ETHARP_SUPPORT_STATIC_ENTRIES=1']

group = AddCodeGroup('beken_sdk', src, depend = ['SOC_FAMILY_BK72XX'], CPPPATH = path, CPPDEFINES = cppdefines, LIBS = libs, LIBPATH = libpath)

for d in list:
    path = os.path.join(cwd, d)
    if os.path.isfile(os.path.join(path, 'SConscript')):
        objs = objs + SConscript(os.path.join(d, 'SConscript'))
lib_name = GetOption('buildlib')

print (lib_name)

if lib_name == 'beken_sdk':
    objs = objs + group
else:
    src = []
    beken_sdk_path = [cwd]
    beken_sdk_libs = ['libbeken_sdk_gcc.a']
    beken_sdk_libs_path = [cwd]
    objs = AddCodeGroup('beken_sdk', src, depend = ['SOC_FAMILY_BK72XX'], CPPPATH = beken_sdk_path, LIBS = beken_sdk_libs, LIBPATH = beken_sdk_libs_path)
#    objs = objs + group
Return('objs')
